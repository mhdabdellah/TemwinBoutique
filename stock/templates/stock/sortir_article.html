
{% extends 'base.html'%}
{% load crispy_forms_tags %}
{% block content %}

<div class="content-wrapper">

  <div class="container-fluid">
  
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="row mr-2 ml-2">
            <div class="col-2">
              <form method="POST" class="needs-validation" novalidate action="{% url 'stock:cart_add' %}">
                {% csrf_token %}
                {{cart_article_form.quantity|as_crispy_field}}
                {{cart_article_form.override|as_crispy_field}}
                
           
            </div>
            <div class="col-10">
              <div id="div_id_numero" class="form-group"> <label for="id_numero" class=" requiredField">
                Numero<span class="asteriskField" style="color: red">*</span> </label> 
                <div class="row">
                  <div class="col-10"> 
                    <div class="input-group mb-3">
                      <span class="input-group-text" id="basic-addon1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="green" class="bi bi-upc-scan" viewBox="0 0 16 16">
                        <path d="M1.5 1a.5.5 0 0 0-.5.5v3a.5.5 0 0 1-1 0v-3A1.5 1.5 0 0 1 1.5 0h3a.5.5 0 0 1 0 1h-3zM11 .5a.5.5 0 0 1 .5-.5h3A1.5 1.5 0 0 1 16 1.5v3a.5.5 0 0 1-1 0v-3a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 1-.5-.5zM.5 11a.5.5 0 0 1 .5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 1 0 1h-3A1.5 1.5 0 0 1 0 14.5v-3a.5.5 0 0 1 .5-.5zm15 0a.5.5 0 0 1 .5.5v3a1.5 1.5 0 0 1-1.5 1.5h-3a.5.5 0 0 1 0-1h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 1 .5-.5zM3 4.5a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0v-7zm2 0a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0v-7zm2 0a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0v-7zm2 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-7zm3 0a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0v-7z"/>
                      </svg></span>
                      <input type="number" name="numero"  class="numberinput form-control" required="" id="id_numero">
                      
                    </div>
                   
            </div>
            <div class="col-2" id="check">
              <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="lightgrey" class="bi bi-check" id='bi-check'viewBox="0 0 16 16">
                <path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"/>
              </svg>
            </div>
                </div>
                
            
            </div>
          </div>
            
    
          <div class="modal-footer">
             <button type="submit" class="btn btn-success p-2 " id='ajoutfac'style="display:none" >Ajouter Au facture</button>
          </div>
        </form>
        </div>
      </div>
</div> 
<div class="container" id="container">
  <div class="card">
    <div class="card-header">
      <div class="row">
        <div class="col-11">
          <input type='text' class="form-control w-25 m-2" value="{{request.user.username}} إسم البائع ">
          <input type='text' class="form-control w-25 m-2" placeholder='اسم الزبون' id="clientname" >
        </div>
         <div class="col-1"> 
          
          <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="cornflowerblue" class="bi bi-printer d-print-none " viewBox="0 0 16 16" onclick="imprimer('container')" role="button">
            <path d="M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1z"/>
            <path d="M5 1a2 2 0 0 0-2 2v2H2a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2H5zM4 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4V3zm1 5a2 2 0 0 0-2 2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v-1a2 2 0 0 0-2-2H5zm7 2v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1z"/>
            
          </svg>
          
         </div>
      </div>
    </div>
    <div class="card-body">   
      <h5 class="card-title">Facture NO:</h5>
        <div class="form-group">
          <table class="table table-striped">
            <div class="modal-content">
                <table class="table table-striped">  
                  {% load crispy_forms_tags %}
                  <thead>
                      <tr>
                          <th>Article</th>
                          <th>quantité</th>
                          <th>prix de chat</th>
                          <th>prix</th>
                          <th class="d-print-none">enlever</th>
                      </tr>
                  </thead>
                  
                      {%for item in cart %}
                     
                      <tr>
                          <td>{{item.article.nom}}</td>
                          <td>
                              <form action="{% url 'stock:update_item' item.article.numero%}" method="post">
                                  <div class="row">
                                      <div class="col-3">
                                        {%csrf_token%}
                                          {{item.update_quantity.quantity}}
                                          {{item.update_quantity.override}}
                                         
                                      </div>
                                      <div class="col-3">
                                        {{item.update_quantity.unite}}
                                         
                                      </div>
                                     
                                  <div class="col-6"><button name='btn' type="submit" class="btn-sm btn-primary d-print-none"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-bag-plus-fill" viewBox="0 0 16 16">
                                      <path fill-rule="evenodd" d="M10.5 3.5a2.5 2.5 0 0 0-5 0V4h5v-.5zm1 0V4H15v10a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V4h3.5v-.5a3.5 3.5 0 1 1 7 0zM8.5 8a.5.5 0 0 0-1 0v1.5H6a.5.5 0 0 0 0 1h1.5V12a.5.5 0 0 0 1 0v-1.5H10a.5.5 0 0 0 0-1H8.5V8z"/>
                                    </svg>
                                  </button>
                                  </div>
                                  
                                  </div>
                                  
                                 
                                  
                              </form>
                          </td>
                          <td>
                             {{ item.prix_achat}}
                          </td>
                          <td>{{item.total_prix}}</td>
                          <td class='d-print-none'>
                              <form action="{% url 'stock:cart_remove' item.article.numero%}" method="post">
                                  {%csrf_token%}
                                  <!-- <input type="hidden" name=""> -->
                                  <button type="submit" class ='btn-sm btn-danger d-print-none'name=""><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                                    <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                                  </svg></button>
                              </form>
                          </td>
                      </tr>
                      
                      {%endfor%}
                      <tr>
                          <td>Total:</td>
                          <td colspan="2"></td>
                          <td>{{cart.get_total_prix}}</td> 
                          <td class="d-print-none"></td>
                      </tr>
                  </tbody>
              
                               
                 </table>
        </div>
                <div class="mt-6">
                  <form action="{% url 'stock:sortir_article' %}" method="POST">
                    {%csrf_token %}
                    <button type="submit" class="btn btn-primary d-print-none p-2 pl-4 pr-4" name="Ajouter">Add</button>
                    <a type="reset" class="btn btn-outline-secondary d-print-none p-2" href="{% url 'stock:clear_cart'%}">Vider</a>
                  </form>
                    
                 
                </div>

   
      
    </div>
  </div>
</div>
 
   {% include 'stock/include_footer.html' %}
</div>

  
  <script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script>
    var changeTimer=false;
    $('#id_numero').keyup('change',function() {
        var url =$('#sortir_form').attr("data-articles-url");
        var article_number=$('#id_numero').val();
        if (changeTimer) clearTimeout(changeTimer);
        changeTimer = setTimeout(function () {
          $.ajax({
        url : url,
        
        data:{
          'article_number':article_number
        },
        success: function(data){
          $('#ajoutfac').css('display','block');
          $('#bi-check').attr('fill', 'green'); 
        },
        isModified: function () {
          console.log('kfjkdfjkd')
          if(true){
            setTimeout(function(){
              location.reload();
            },0001);
          }
          
        },
        complete: function(){
         
        }
            
      });
        },200)
      
     
});
$('#clientname').keyup('change',function() {
  $(this).setAttribute('disabled','')
})

</script>
<script>
  function imprimer(divname){
  var headstr="<html><head><title></title></head><body>";
  var footstr="</body>";
  var newstr=document.getElementById('container').innerHTML;
  document.querySelectorAll('btn').forEach(btn=>btn.remove());
  document.body.innerHTML=newstr;
  var oldstr=document.body.innerHTML;
  document.body.innerHTML= headstr + newstr + footstr;
  window.print();
  document.body.innerHTML=oldstr;
  return false;
  }
  </script>
{% endblock content %}